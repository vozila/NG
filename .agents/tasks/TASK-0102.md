# TASK-0102: WhatsApp inbound adapter (minimal) -> unified engine stub

Status: NOT STARTED  
Owner: Codex Agent (WhatsApp)

Feature flag: `VOZ_FEATURE_WHATSAPP_IN` (default OFF)

## Goal
Create a minimal WhatsApp inbound webhook that:
 - receives inbound messages (MVP accepts a simplified payload structure)
- normalizes to a common message event structure
- forwards to a placeholder engine function (deterministic stub for now)

## Constraints
- Only modify: `features/whatsapp_in.py` (and optional test file)
- No cross-feature imports. Only stdlib + `core/*`.
 - No heavy work in handler.
- Debug logs gated behind `VOZLIA_DEBUG=1` only.

---

## Deliverables
- `POST /whatsapp/inbound` route
- Normalization helper:
  - input: raw payload dict
  - output: {channel: "whatsapp", from, to, text, media_urls:[], ts}

 ## FEATURE contract
Export `FEATURE` with `enabled_env="VOZ_FEATURE_WHATSAPP_IN"`.

## selftests()
- Validate normalization on sample payloads (including missing fields)
- Verify route mounting off/vs on

## security_checks()
- Include TODO: signature validation (whether Twilio or Meta) 
- No tenant derivation in handler yet (routing is separate engine responsibility)

## load_profile()
Stub.

## Acceptance
```bash
python -m compileall core features scripts main.py
python -m ruff check core features scripts tests main.py
pytest -q
VOZ_FEATURE_ADMIN_QUALITY=1 VOZ_FEATURE_SAMPLE=1 python scripts/run_regression.py
```
Rollback: VOZ_FEATURE_WHATSATP_IN=0
