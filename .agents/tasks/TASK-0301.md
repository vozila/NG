# TASK-0301: Owner analytics query endpoint (QuerySpec + safe executor)

Status: DONE  
Assigned: Codex Agent B  
Date: 2026-02-19 (America/New_York)

## Objective
Create an owner analytics foundation endpoint for future owner Q&A that is deterministic, bounded, and auditable.

## Endpoint
- `POST /owner/analytics/query`
- Auth: `Authorization: Bearer <VOZ_OWNER_API_KEY>`
- Gates:
  - `VOZ_FEATURE_OWNER_ANALYTICS_QUERY=1`
  - `VOZ_OWNER_ANALYTICS_QUERY_ENABLED=1`

## QuerySpec
- `metrics` allowlist:
  - `count_calls`, `count_leads`, `count_appt_requests`, `count_transcripts`
- `dimensions` allowlist:
  - `day`, `event_type`, `ai_mode`
- `filters`:
  - event type include list
  - ai_mode include list (`customer|owner`)
- `limit <= 200`

## Safety constraints
- Tenant isolation mandatory on every query.
- SELECT-only deterministic execution.
- Time window bounded to max 7 days.
- Invalid metric/dimension/limit rejected with 422.

## Acceptance coverage
- Seeded counts are returned correctly.
- Tenant isolation enforced.
- Safety checks validated:
  - limit > 200 => 422
  - window > 7 days => 400
  - invalid metric/dimension => 422
