# TASK-0204: Flow A actor_mode policy (client vs owner) â€” mode-specific instructions/persona (hot-path safe)

Status: DONE
Owner: Codex Agent (Voice)
Feature flag: `VOZ_FEATURE_VOICE_FLOW_A` (existing)
Kill-switch: `VOZ_FLOW_A_OPENAI_BRIDGE=0` (existing; emergency rollback)

## Goal
Use `actor_mode` (set by shared-line access code) to apply mode-specific communication protocols in Flow A:
- `actor_mode=client`: customer-facing assistant behavior
- `actor_mode=owner`: owner-facing assistant behavior (analytics persona; no customer service tone)

This remains hot-path safe: selection occurs on Twilio `start` only and no DB work is added.

## Scope Delivered
- Reads `actor_mode` from `start.customParameters.actor_mode`
- Validates mode to `client|owner` with fail-closed default to `client`
- Adds env-first policy resolver with kill-switch `VOZ_FLOW_A_ACTOR_MODE_POLICY` (default OFF)
- Applies selected `voice` + `instructions` in `session.update`
- Adds required debug breadcrumbs
- Adds deterministic resolver unit tests
- Updates memory spine docs (`ops/REFERENCE_PACKS/voice_flow_a.md`, `ops/JOURNAL.md`, `ops/CHECKPOINT.md`)

## Policy Resolution Rules Implemented
1. Determine `tenant_id` and validated `actor_mode`
2. If `VOZ_FLOW_A_ACTOR_MODE_POLICY=0`:
   - use existing globals only (`VOZ_OPENAI_REALTIME_VOICE`, `VOZ_OPENAI_REALTIME_INSTRUCTIONS`)
3. If `VOZ_FLOW_A_ACTOR_MODE_POLICY=1`:
   - prefer `VOZ_TENANT_MODE_POLICY_JSON` tenant+mode override
   - else mode envs (`..._CLIENT|..._OWNER`)
   - else existing globals
   - else safe defaults

## Debug Breadcrumbs Added
- `TWILIO_WS_START ... actor_mode=...`
- `VOICE_FLOW_A_START ... actor_mode=...`
- `VOICE_MODE_SELECTED tenant_id=... actor_mode=... voice=...`

## Tests Added
- Unknown actor mode defaults to client path
- Tenant policy JSON owner override
- Fallback to global mode envs when policy JSON missing
- Kill-switch OFF preserves current base behavior

## Rollback
- `VOZ_FLOW_A_OPENAI_BRIDGE=0` (immediate)
- `VOZ_FLOW_A_ACTOR_MODE_POLICY=0` (disable new mode policy logic)
